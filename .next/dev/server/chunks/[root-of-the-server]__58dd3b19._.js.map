{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Pcc/Desktop/groww/finboard/lib/finance/providers/finnhub.ts"],"sourcesContent":["import {\r\n  FinanceRequestPayload,\r\n  UnifiedQuote,\r\n  UnifiedTimeSeries,\r\n  UnifiedCandlePoint,\r\n} from \"../types\";\r\n\r\nconst BASE_URL = \"https://finnhub.io/api/v1\";\r\n\r\nexport async function finnhubAdapter(\r\n  payload: FinanceRequestPayload,\r\n  apiKey: string\r\n): Promise<any> {\r\n  const { endpoint, symbol, symbols, interval } = payload;\r\n\r\n  switch (endpoint) {\r\n    case \"quote\":\r\n      if (!symbol) throw new Error(\"symbol is required for quote\");\r\n      return fetchQuote(symbol, apiKey);\r\n    case \"timeSeries\":\r\n      if (!symbol) throw new Error(\"symbol is required for timeSeries\");\r\n      return fetchTimeSeries(symbol, interval ?? \"1D\", apiKey);\r\n    case \"gainers\":\r\n      return fetchGainers(symbols || [], apiKey);\r\n    case \"search\":\r\n      if (!symbol) throw new Error(\"query is required for search\");\r\n      return fetchSearch(symbol, apiKey);\r\n    default:\r\n      throw new Error(`Unsupported Finnhub endpoint: ${endpoint}`);\r\n  }\r\n}\r\n\r\nasync function fetchQuote(symbol: string, apiKey: string): Promise<UnifiedQuote> {\r\n  const [quoteRes, profileRes] = await Promise.all([\r\n    fetch(`${BASE_URL}/quote?symbol=${symbol}&token=${apiKey}`),\r\n    fetch(`${BASE_URL}/stock/profile2?symbol=${symbol}&token=${apiKey}`),\r\n  ]);\r\n\r\n  if (!quoteRes.ok) {\r\n    throw new Error(`Finnhub API error: ${quoteRes.status}`);\r\n  }\r\n\r\n  const quote = await quoteRes.json();\r\n  const profile = await profileRes.json();\r\n\r\n  return {\r\n    symbol,\r\n    name: profile.name || symbol,\r\n    price: quote.c,\r\n    change: quote.d,\r\n    changePercent: quote.dp,\r\n    high: quote.h,\r\n    low: quote.l,\r\n    open: quote.o,\r\n    prevClose: quote.pc,\r\n    currency: profile.currency || \"USD\",\r\n  };\r\n}\r\n\r\nasync function fetchTimeSeries(\r\n  symbol: string,\r\n  interval: \"1D\" | \"1W\" | \"1M\",\r\n  apiKey: string\r\n): Promise<UnifiedTimeSeries> {\r\n  const resolution = interval === \"1D\" ? \"D\" : interval === \"1W\" ? \"W\" : \"M\";\r\n  const to = Math.floor(Date.now() / 1000);\r\n  const days = interval === \"1D\" ? 30 : interval === \"1W\" ? 90 : 365;\r\n  const from = to - days * 24 * 60 * 60;\r\n\r\n  const res = await fetch(\r\n    `${BASE_URL}/stock/candle?symbol=${symbol}&resolution=${resolution}&from=${from}&to=${to}&token=${apiKey}`\r\n  );\r\n\r\n  if (!res.ok) {\r\n    throw new Error(`Finnhub API error: ${res.status}`);\r\n  }\r\n\r\n  const data = await res.json();\r\n\r\n  if (data.s === \"no_data\") {\r\n    return { symbol, points: [] };\r\n  }\r\n\r\n  const points: UnifiedCandlePoint[] = data.t.map((timestamp: number, index: number) => ({\r\n    timestamp: timestamp * 1000,\r\n    date: new Date(timestamp * 1000).toLocaleDateString(),\r\n    open: data.o[index],\r\n    high: data.h[index],\r\n    low: data.l[index],\r\n    close: data.c[index],\r\n    volume: data.v[index],\r\n  }));\r\n\r\n  return { symbol, points };\r\n}\r\n\r\nasync function fetchGainers(symbols: string[], apiKey: string): Promise<UnifiedQuote[]> {\r\n  if (symbols.length === 0) {\r\n    symbols = [\"AAPL\", \"MSFT\", \"GOOGL\", \"AMZN\", \"TSLA\", \"NVDA\", \"META\", \"NFLX\"];\r\n  }\r\n\r\n  const quotes = await Promise.all(\r\n    symbols.map(async (symbol) => {\r\n      try {\r\n        return await fetchQuote(symbol, apiKey);\r\n      } catch {\r\n        return null;\r\n      }\r\n    })\r\n  );\r\n\r\n  return quotes\r\n    .filter((q): q is UnifiedQuote => q !== null && q.changePercent > 0)\r\n    .sort((a, b) => b.changePercent - a.changePercent)\r\n    .slice(0, 5);\r\n}\r\n\r\nasync function fetchSearch(query: string, apiKey: string): Promise<any> {\r\n  const res = await fetch(`${BASE_URL}/search?q=${query}&token=${apiKey}`);\r\n\r\n  if (!res.ok) {\r\n    throw new Error(`Finnhub API error: ${res.status}`);\r\n  }\r\n\r\n  const data = await res.json();\r\n\r\n  return data.result.slice(0, 10).map((item: any) => ({\r\n    symbol: item.symbol,\r\n    name: item.description,\r\n    type: item.type,\r\n    exchange: item.displaySymbol,\r\n  }));\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 245, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Pcc/Desktop/groww/finboard/lib/finance/fetchFromProvider.ts"],"sourcesContent":["import { FinanceRequestPayload } from \"./types\";\r\nimport { finnhubAdapter } from \"./providers/finnhub\";\r\nimport axios from \"axios\";\r\n\r\ntype CacheKey = string;\r\n\r\ninterface CacheEntry {\r\n    timestamp: number;\r\n    data: any;\r\n}\r\n\r\n// In-memory cache\r\nconst cache = new Map<CacheKey, CacheEntry>();\r\n\r\nconst CACHE_TTL_MS = 60_000; // 60 seconds\r\n\r\nfunction buildCacheKey(payload: FinanceRequestPayload): CacheKey {\r\n    return JSON.stringify(payload);\r\n}\r\n\r\nexport async function fetchFromProvider(payload: FinanceRequestPayload) {\r\n    const cacheKey = buildCacheKey(payload);\r\n    const now = Date.now();\r\n\r\n    // Check cache\r\n    const cached = cache.get(cacheKey);\r\n    if (cached && now - cached.timestamp < CACHE_TTL_MS) {\r\n        return cached.data;\r\n    }\r\n\r\n    let data: any;\r\n\r\n    try {\r\n        switch (payload.provider) {\r\n            case \"finnhub\": {\r\n                const apiKey = process.env.FINNHUB_API_KEY || process.env.NEXT_PUBLIC_FINNHUB_API_KEY || \"demo\";\r\n                data = await finnhubAdapter(payload, apiKey);\r\n                break;\r\n            }\r\n            case \"custom\": {\r\n                if (!payload.customUrl) {\r\n                    throw new Error(\"customUrl is required for custom provider\");\r\n                }\r\n                const response = await axios.get(payload.customUrl, { timeout: 10000 });\r\n                data = response.data;\r\n                break;\r\n            }\r\n            default:\r\n                throw new Error(`Unsupported provider: ${payload.provider}`);\r\n        }\r\n    } catch (err: any) {\r\n        // Handle rate limiting\r\n        if (err.response?.status === 429) {\r\n            throw new Error(\"API rate limit exceeded. Please try again later.\");\r\n        }\r\n        throw err;\r\n    }\r\n\r\n    // Cache the result\r\n    cache.set(cacheKey, { data, timestamp: now });\r\n    return data;\r\n}\r\n\r\n// Clear old cache entries periodically\r\nsetInterval(() => {\r\n    const now = Date.now();\r\n    for (const [key, entry] of cache.entries()) {\r\n        if (now - entry.timestamp > CACHE_TTL_MS * 2) {\r\n            cache.delete(key);\r\n        }\r\n    }\r\n}, CACHE_TTL_MS);\r\n"],"names":[],"mappings":";;;;AACA;AACA;;;AASA,kBAAkB;AAClB,MAAM,QAAQ,IAAI;AAElB,MAAM,eAAe,QAAQ,aAAa;AAE1C,SAAS,cAAc,OAA8B;IACjD,OAAO,KAAK,SAAS,CAAC;AAC1B;AAEO,eAAe,kBAAkB,OAA8B;IAClE,MAAM,WAAW,cAAc;IAC/B,MAAM,MAAM,KAAK,GAAG;IAEpB,cAAc;IACd,MAAM,SAAS,MAAM,GAAG,CAAC;IACzB,IAAI,UAAU,MAAM,OAAO,SAAS,GAAG,cAAc;QACjD,OAAO,OAAO,IAAI;IACtB;IAEA,IAAI;IAEJ,IAAI;QACA,OAAQ,QAAQ,QAAQ;YACpB,KAAK;gBAAW;oBACZ,MAAM,SAAS,QAAQ,GAAG,CAAC,eAAe,IAAI,QAAQ,GAAG,CAAC,2BAA2B,IAAI;oBACzF,OAAO,MAAM,IAAA,0JAAc,EAAC,SAAS;oBACrC;gBACJ;YACA,KAAK;gBAAU;oBACX,IAAI,CAAC,QAAQ,SAAS,EAAE;wBACpB,MAAM,IAAI,MAAM;oBACpB;oBACA,MAAM,WAAW,MAAM,kJAAK,CAAC,GAAG,CAAC,QAAQ,SAAS,EAAE;wBAAE,SAAS;oBAAM;oBACrE,OAAO,SAAS,IAAI;oBACpB;gBACJ;YACA;gBACI,MAAM,IAAI,MAAM,CAAC,sBAAsB,EAAE,QAAQ,QAAQ,EAAE;QACnE;IACJ,EAAE,OAAO,KAAU;QACf,uBAAuB;QACvB,IAAI,IAAI,QAAQ,EAAE,WAAW,KAAK;YAC9B,MAAM,IAAI,MAAM;QACpB;QACA,MAAM;IACV;IAEA,mBAAmB;IACnB,MAAM,GAAG,CAAC,UAAU;QAAE;QAAM,WAAW;IAAI;IAC3C,OAAO;AACX;AAEA,uCAAuC;AACvC,YAAY;IACR,MAAM,MAAM,KAAK,GAAG;IACpB,KAAK,MAAM,CAAC,KAAK,MAAM,IAAI,MAAM,OAAO,GAAI;QACxC,IAAI,MAAM,MAAM,SAAS,GAAG,eAAe,GAAG;YAC1C,MAAM,MAAM,CAAC;QACjB;IACJ;AACJ,GAAG"}},
    {"offset": {"line": 317, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Pcc/Desktop/groww/finboard/app/api/finance/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\nimport { fetchFromProvider } from \"@/lib/finance/fetchFromProvider\";\r\nimport { FinanceRequestPayload } from \"@/lib/finance/types\";\r\n\r\nexport async function POST(req: NextRequest) {\r\n    try {\r\n        const body: FinanceRequestPayload = await req.json();\r\n\r\n        // Validate request\r\n        if (!body.provider || !body.endpoint) {\r\n            return NextResponse.json(\r\n                { error: true, message: \"provider and endpoint are required\" },\r\n                { status: 400 }\r\n            );\r\n        }\r\n\r\n        // Fetch data from provider (API keys are secure on server)\r\n        const data = await fetchFromProvider(body);\r\n\r\n        return NextResponse.json({ data }, { status: 200 });\r\n    } catch (err: any) {\r\n        console.error(\"Finance API error:\", err);\r\n\r\n        const statusCode = err.response?.status || 500;\r\n        const message = err.message || \"Something went wrong\";\r\n\r\n        return NextResponse.json(\r\n            {\r\n                error: true,\r\n                message,\r\n            },\r\n            { status: statusCode }\r\n        );\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAGO,eAAe,KAAK,GAAgB;IACvC,IAAI;QACA,MAAM,OAA8B,MAAM,IAAI,IAAI;QAElD,mBAAmB;QACnB,IAAI,CAAC,KAAK,QAAQ,IAAI,CAAC,KAAK,QAAQ,EAAE;YAClC,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,OAAO;gBAAM,SAAS;YAAqC,GAC7D;gBAAE,QAAQ;YAAI;QAEtB;QAEA,2DAA2D;QAC3D,MAAM,OAAO,MAAM,IAAA,0JAAiB,EAAC;QAErC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;QAAK,GAAG;YAAE,QAAQ;QAAI;IACrD,EAAE,OAAO,KAAU;QACf,QAAQ,KAAK,CAAC,sBAAsB;QAEpC,MAAM,aAAa,IAAI,QAAQ,EAAE,UAAU;QAC3C,MAAM,UAAU,IAAI,OAAO,IAAI;QAE/B,OAAO,gJAAY,CAAC,IAAI,CACpB;YACI,OAAO;YACP;QACJ,GACA;YAAE,QAAQ;QAAW;IAE7B;AACJ"}}]
}